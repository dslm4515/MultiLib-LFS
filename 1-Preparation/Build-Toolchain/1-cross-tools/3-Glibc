# Cross-Tools: Glibc 
# Build and install as lfs

# NOTE: Glibc headers required to build static GCC

# Some of the Glibc programs use the non-FHS-compliant 
# /var/db directory to store their runtime data. Apply the 
# following patch to make such programs store their runtime 
# data in the FHS-compliant locations: 
patch -Np1 -i ../patches/glibc-2.42-fhs-1.patch 

# The Glibc documentation recommends building Glibc in a 
# dedicated build directory:
mkdir -v build
cd       build

# Set the build options
export  CARGS="--prefix=/cross-tools "
export CARGS+="--host=$LFS_TGT "
export CARGS+="--build=$(../scripts/config.guess) "
export CARGS+="--enable-kernel=5.4 "
export CARGS+="--with-headers=/cross-tools/include "
export CARGS+="--disable-nscd "
export CARGS+="libc_cv_slibdir=/cross-tools/lib " 

export CARGS+="--disable-werror --with-headers=/cross-tools/include "

# Ensure that the ldconfig and sln utilities are installed into /tools/bin:
echo "rootsbindir=/cross-tools/bin" > configparms 

# Configure the source
../configure $CARGS

# Compile
make

# Install to cross-tools
make install

# Creat a link so the dynamic loader can be found
ln -sv lib /cross-tools/lib64
