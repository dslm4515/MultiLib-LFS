# Tools: Bzip2
# Build & install as LFS

# The following command ensures installation of symbolic links 
# are relative: 
sed -i 's@\(ln -s -f \)$(PREFIX)/bin/@\1@' Makefile

# Prepare Bzip2 for compilation with: 
make -f Makefile-libbz2_so
make clean

# Compile the 64-bit build
make

# Install the 64-bit shared library: 
cp -av libbz2.so.* /tools/lib
ln -sv libbz2.so.1.0.8 /tools/lib/libbz2.so

# Install the shared bzip2 binary into the /tools/bin directory, 
# and replace two copies of bzip2 with symlinks: 
cp -v bzip2-shared /tools/bin/bzip2
for i in /tools/bin/{bzcat,bunzip2}; do
  ln -sfv bzip2 $i
done

# Compile the 32-bit build
make clean
sed -e "s/^CC=.*/CC=gcc -m32/" -i Makefile{,-libbz2_so}
make -f Makefile-libbz2_so
make libbz2.a

# Install the 32-bit shared library: 
install -Dm755 libbz2.so.1.0.8 /tools/lib32/libbz2.so.1.0.8
ln -sf libbz2.so.1.0.8  /tools/lib32/libbz2.so
ln -sf libbz2.so.1.0.8  /tools/lib32/libbz2.so.1
ln -sf libbz2.so.1.0.8  /tools/lib32/libbz2.so.1.0
install -Dm644 libbz2.a /tools/lib32/libbz2.a
